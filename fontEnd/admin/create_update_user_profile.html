<meta charset="UTF-8">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.css">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
    if (!sessionStorage.getItem('token')) {
        location.href = 'login.html';
    }

    function logOut() {
        sessionStorage.removeItem('token');
        location.href = 'login.html';
    }
</script>
<div id='app' > 
<nav class="navbar navbar-expand-lg navbar-dark p-0" style="background-color: #1f282dd9">
    <div class="navbar-nav">
        <a class="nav-item nav-link" href="index_admin.html">Quản lý bài viết</a>
        <a class="nav-item nav-link" href="category_list.html">Quản lý nhóm bài viết</a>
    </div>

    <ul class="navbar-nav ml-auto">
        <li class="nav-item dropdown no-arrow">
            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">
                <img v-if="user.body.author_photo" class="rounded-circle z-depth-2" style="width:70px" :src="API_URL+'/' + user.body.author_photo">
                <img v-else class="rounded-circle" style="width:60px" src="user.svg">

            </a>
            <div class="dropdown-menu dropdown-menu-right">
                <a class="dropdown-item" href="user_profile.html">
                    Thông tin tài khoản
                </a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#" onclick="logOut()">
                    Đăng xuất
                </a>
            </div>
        </li>
    </ul>
</nav>

<div class="mt-3 container">
  <template>
      <form id='fmt' @submit.prevent="save()">
          <table class="table">
              <tr>
                  <th>Tên tài khoản:</th>
                  <th><p class="form-control" style="color: blue;">{{ user.body.author_name }}</p></th>
              </tr>
              <tr>
                <th>Email đăng nhập:</th>
                <th><p class="form-control" style="color: blue;">{{ user.body.author_email }}</p></th>
              </tr>
              <tr>
                <th>Địa chỉ:</th>
                <td><input class="form-control" v-model="user.body.author_add" name="author_add"></td>
              </tr>
              <tr>
                <th>Ảnh đại diện:</th>
                <td>
                  <img v-if="user.body.author_photo" :src="API_URL+'/' + user.body.author_photo" class="form"
                    style="width: 100px;"><br v-if="user.body.author_photo">
                  <input class="formData mt-3" id='image' type="file" @change="updateImage($event)" name="thumbnail">
                </td>
              </tr>
              <tr>
                <th>Giới tính:</th>
                <td>
                  <select v-model="user.body.author_gender" class="form-control">
                    <option >Khác</option>
                    <option>Nam</option>
                    <option>Nữ</option>
                  </select><br>
                  <span>{{ user.body.author_gender }}</span></td>
              </tr>
              <tr>
                <th>SĐT:</th>
                <td><input class="form-control" v-model="user.body.author_phone" name="author_phone"></td>
              </tr>
          </table>
          <a class='btn btn-secondary' href='user_profile.html'>Quay lại</a>
          <button  class="btn btn-primary" type="submit">Lưu lại</button>
      </form>
  </template>
</div>
</div>

<script>
    new Vue({
      el: '#app',
      data: { 
          selected: '',
          user: {
              body:{
                  author_name:"",
                  author_email:"",
                  author_add:"",
                  author_photo:"",
                  author_phone:"",
                  author_gender:"",
                  author_id:"",
              }}
          ,
          API_URL: 'http://localhost:8000',
         },
      created: async function () {
          await this.getUser();
      },
      methods:{
          updateImage: function (ev) {
                  this.updata_thumbnail = ev.target.files[0];
              },
          getUser: async function(){
            var resp = await fetch(this.API_URL+"/root/get_user",
                    {
                        headers: {'Authorization': 'Bearer ' + sessionStorage.getItem('token'), "Content-Type": "application/json",}
                    });
                    this.user = await resp.json();
                    console.log(this.user)
                    if(this.user.body.success === false){
                        sessionStorage.removeItem('token');
                        location.href = 'login.html';
                    }
                    
          },            
          post: async function (url, formData) {
                var resp = await fetch(url, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Authorization': 'Bearer '
                            + sessionStorage.getItem('token')
                    },
                });
                return resp.json();
            },
            put: async function (url, body) {
                var resp = await fetch(url, {
                    method: 'PUT',
                    body: body,
                    headers: {
                        'Authorization': 'Bearer '+ sessionStorage.getItem('token'),
                        "Content-Type": "application/json",
                    },
                });
                return resp.json();
            },
            save: async function () {
                var result = {};

                // if (this.id) {
                //     var body = JSON.stringify(this.category.body);
                //     console.log(body)
                //     result = await this.put(this.API_URL + '/root/update_category/' + this.id,
                //             body);
                //     console.log(result);
                // } else {
                //     var fmt = document.getElementById('fmt');
                //     result = await this.post(this.API_URL + '/root/create_category',
                //         new FormData(fmt));
                //     console.log(result)
                // }
                // if (result.body.success) {
                //     alert('Thành công'),
                //         location.href = 'category_list.html';
                // } else {
                //     alert('Lỗi xảy ra khi ghi dữ liệu');
                // }
            }
      }
    })
  </script>